
##  Contentstack Android GraphQL

In order to pull data from the new Contentstack GraphQL endpoint (now in dev), Apollo for Android Client can be used.

###  Setup

Installing dependencies can be achieved by adding the following statements to the root build.gradle file.  

    buildscript {  
    repositories {  
    jcenter()  
    }  
    dependencies {  
    classpath 'com.apollographql.apollo:apollo-gradle-plugin:1.0.0-alpha2'  
    }  
    }

  
The application-specific build.gradle needs to load the plugin and depend on the runtime libraries:

    // other apply statements, Apollo needs to be last  
    apply plugin: 'com.apollographql.android'  
    
    dependencies {  
    // more implementation statments  
    implementation 'com.apollographql.apollo:apollo-runtime:1.0.0-alpha2'  
    }

  
Once dependencies have been declared, setup is done by providing the authorization header. The following is an example of doing so:  
  
  

### Download schema

For generating the java models, a GraphQL schema and a query are required. The schema can be generated by using the Apollo CLI, which can be obtained from the Apollo CLI GitHub page:

Open your terminal and Letâ€™s download on Desktop

    apollo-codegen introspect-schema https://dev-graphql.contentstack.io/stacks/API_KEY/explore?access_token=TOKEN&environment=ENV_NAME --output schema.json



### Queries

The following is an example of a sample query for GraphQL:

    query allProduct {  
    all_product(locale: "en-us") {  
    items{  
      title  
      price  
      featured_image{  
        url  
      } 
      } 
     }  
    }



### Model generation

By using Apollo for Android and placing this query and the schema in the right folder (i.e. /app/src/main/graphql/getAllProducts.graphql), the Apollo plugin creates classes that can be used for querying.

    // put .graphql and schema.json file in below location
    /app/src/main/graphql/getAllProducts.graphql
    /app/src/main/graphql/schema.json

The following is an example of the query created by using the above-mentioned classes :

### Apollo Builder 

    okHttpClient = new OkHttpClient.Builder().addInterceptor(chain -> {  
        Request original = chain.request();  
        Request.Builder builder = original.newBuilder().method(original.method(), original.body());  
        Add below authentications  
        //builder.header("environment", "stack_environment");  
        //builder.header("access-token", api_key);  
        return chain.proceed(builder.build());  
        }).build();  
    apolloClient=ApolloClient.builder().serverUrl(BASE_URL).okHttpClient(okHttpClient).build();

  
Additionally, the snippet above sets the Stack and the Locale to be used by the client.





### JAVA

    apolloClient.query(AllProductQuery.builder().build()).enqueue(new ApolloCall.Callback<AllProductQuery.Data>() {  
    @Override  
    public void onResponse(@NotNull Response<AllProductQuery.Data> response) {  
    Log.e(TAG, response.data().category().toString());  
    }  
    }  
    @Override  
    public void onFailure(@NotNull ApolloException e) {  
    Log.e(TAG, e.getLocalizedMessage());  
    }  
    });

